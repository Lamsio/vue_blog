(window.webpackJsonp=window.webpackJsonp||[]).push([[122],{451:function(a,t,r){"use strict";r.r(t);var s=r(4),v=Object(s.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h4",{attrs:{id:"简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[a._v("#")]),a._v(" 简介")]),a._v(" "),t("p",[a._v("在日常的企业设备搭建中，我们不得不考虑到设备的健壮性问题\n"),t("img",{attrs:{src:"/more/Pasted%20image%2020221218140926.png",alt:"avatar"}})]),a._v(" "),t("p",[a._v("企业的设备接入主要分为三层（接入层、汇聚层、核心层），但设备总有坏的一天，前人想到的方法是接入一台额外的备用设备，但很明显，线路也增加了一倍。而且不仅仅是设备有损坏的风险，常见的线路也会损坏，这意味着不得不为一条线路准备一条以上的备用线路，而实际企业网络构建中可能涉及了成百上千的设备，如果都这样做，线路将变得极其复杂且冗余！")]),a._v(" "),t("h4",{attrs:{id:"潜在的问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#潜在的问题"}},[a._v("#")]),a._v(" 潜在的问题")]),a._v(" "),t("p",[a._v("上述结构可能面临一个严重的问题 —— 环路广播风暴\n这个问题十分严重，试想当主机发送了一个广播数据包时，交换机会将其泛洪，然后一台交换机后面存在着数十台交换机，交换机收到广播包后依旧会泛洪，永无止境的来回泛洪会耗尽设备的资源从而导致网络瘫痪！\n"),t("img",{attrs:{src:"/more/Pasted%20image%2020221218142654.png",alt:"avatar"}})]),a._v(" "),t("h4",{attrs:{id:"stp协议"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#stp协议"}},[a._v("#")]),a._v(" STP协议")]),a._v(" "),t("p",[a._v("STP通过阻塞端口来消除环路，并且实现链路备份的目的\n"),t("img",{attrs:{src:"/more/Pasted%20image%2020221218142912.png",alt:"avatar"}})]),a._v(" "),t("p",[a._v("该协议使交换机间通过发送BPDU数据包来选举一个根桥，BPDU数据包包含了以下几个内容：")]),a._v(" "),t("ol",[t("li",[a._v("ROOTID (优先级+MAC)")]),a._v(" "),t("li",[a._v("到达ROOT的COST")]),a._v(" "),t("li",[a._v("BID (自己的优先级+自己的MAC)")]),a._v(" "),t("li",[a._v("PID (端口优先级+端口编号)")])]),a._v(" "),t("p",[a._v("在STP中，默认优先级是32768且优先级必须是4096的倍数。")]),a._v(" "),t("p",[a._v("在对比过程中，数值越小越优先，赢的一方负责发波，发波口称为DP，接收口称为RP，切记每个设备仅有一个RP口，当设备与多台设备间对比都不赢时，选择最强波方向的接收口作为RP，其余的口全丢弃从而"),t("strong",[a._v("实现无环")]),a._v("。\n"),t("img",{attrs:{src:"/more/Pasted%20image%2020221218150208.png",alt:"avatar"}})]),a._v(" "),t("h4",{attrs:{id:"端口的生命周期"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#端口的生命周期"}},[a._v("#")]),a._v(" 端口的生命周期")]),a._v(" "),t("p",[t("img",{attrs:{src:"/more/Pasted%20image%2020221218151038.png",alt:"avatar"}})]),a._v(" "),t("ul",[t("li",[a._v("Disabled ：任何端口在一开始都是down状态")]),a._v(" "),t("li",[a._v("Blocking ：在启动端口后有一小段时间处于阻塞状态")]),a._v(" "),t("li",[a._v("Listening ：进入监听状态，开始STP选举，大概需要15秒")]),a._v(" "),t("li",[a._v("Learning ： 学习MAC地址")]),a._v(" "),t("li",[a._v("Forwarding ： 收发用户数据")])]),a._v(" "),t("h4",{attrs:{id:"stp-计时器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#stp-计时器"}},[a._v("#")]),a._v(" STP 计时器")]),a._v(" "),t("p",[a._v("通常情况下，BPDU报文每两秒发送一次，BPDU报文每经过一个交换机，Message age都会加一，如果Message age大于Max age，非根桥则会丢弃该BPDU\n"),t("img",{attrs:{src:"/more/Pasted%20image%2020221218152606.png",alt:"avatar"}})]),a._v(" "),t("p",[a._v("假设有该网络拓扑，假如LSW3的 GE0/0/2接口突然中断了，会发生什么事？")]),a._v(" "),t("p",[a._v("此时LSW3的GE0/0/1会与LSW2 GE0/0/2重新进行选举，根据生命周期得知，这将会重新进入Listening和Learning状态，这两个状态加起来需要30秒完成，因此"),t("strong",[a._v("接入层网络")]),a._v("将会有30秒受到影响。\n"),t("img",{attrs:{src:"/more/Pasted%20image%2020221218153623.png",alt:"avatar"}})]),a._v(" "),t("p",[a._v("但如果是核心层故障，就不只是三十秒了，"),t("a",{attrs:{href:"https://www.cnblogs.com/641055499-mozai/p/11622220.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("网络初级篇之STP（BPDU详解与STP故障恢复） - 沫仔 - 博客园 (cnblogs.com)"),t("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=v.exports}}]);